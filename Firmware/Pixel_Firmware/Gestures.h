#define GESTURE_COUNT 9
#define AXIS_COUNT 3
#define GESTURE_SIGNATURE_MAXIMUM_SIZE 35
#define GESTURE_CANDIDATE_SIZE 35 // The number of most recent live data points to store

int classifiedGestureIndex = 0;
int previousClassifiedGestureIndex = -1;
unsigned long lastGestureClassificationTime = 0L; // Time of last gesture classification

char* gestureName[GESTURE_COUNT] = {
	"at rest",
	"swing",
	"tap to another, as left",
	"tap to another, as right",
	"shake",
	"tilt left",
	"tilt right",
	"tilt forward",
	"tilt backward"
};

int gestureSignatureSize[] = { 35, 35, 35, 35, 35, 35, 35, 35, 35 };

int gestureSustainDuration[GESTURE_COUNT] = {
	0, // "at rest"
	1000, // 600, // "swing"
	800, // 800, // "tap to another, as left"
	800, // 800,  // "tap to another, as right"
	600, // 200, // "shake"
	0, // "tilt left"
	0, // "tilt right"
	0, // "tilt forward"
	0 // "tilt backward"
};

int gestureTransitions[GESTURE_COUNT][GESTURE_COUNT] = {
	{ 0, 1, 4, 2, 3, -1, -1, -1, -1 }, // { 0, 1, 5, 6, 7, 8, 2, 3, 4 },
	{ 0, 4, 2, 3, -1, -1, -1, -1, -1 }, // { 0, 4, 5, 6, 7, 8, 2, 3, -1 },
	{ 0, -1, -1, -1, -1, -1, -1, -1, -1 },
	{ 0, -1, -1, -1, -1, -1, -1, -1, -1 },
	{ 4, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 5, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 6, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 7, 0, -1, -1, -1, -1, -1, -1, -1 },
	{ 8, 0, -1, -1, -1, -1, -1, -1, -1 }
};
// int gestureTransitions[GESTURE_COUNT][GESTURE_COUNT] = {
// 	{ 0, 1, 5, 6, 7, 8, 2, 3, -1 },
// 	{ 0, 4, 5, 6, 7, 8, 2, 3, -1 },
// 	{ 0, -1, -1, -1, -1, -1, -1, -1, -1 },
// 	{ 0, -1, -1, -1, -1, -1, -1, -1, -1 },
// 	{ 4, 0, -1, -1, -1, -1, -1, -1, -1 },
// 	{ 5, 0, -1, -1, -1, -1, -1, -1, -1 },
// 	{ 6, 0, -1, -1, -1, -1, -1, -1, -1 },
// 	{ 7, 0, -1, -1, -1, -1, -1, -1, -1 },
// 	{ 8, 0, -1, -1, -1, -1, -1, -1, -1 }
// };
int gestureCandidateSize = 0; // Current size of the live gesture data
int gestureCandidate[AXIS_COUNT][GESTURE_CANDIDATE_SIZE] = {
	{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
};


int gestureSampleCount = 0;
int gestureSensorSampleCount = 0;
int gestureSignature[GESTURE_COUNT][AXIS_COUNT][GESTURE_SIGNATURE_MAXIMUM_SIZE] = {
	{
		{ 33, 27, 26, 28, 37, 32, 29, 27, 27, 27, 30, 31, 31, 28, 26, 25, 29, 31, 33, 32, 23, 22, 26, 32, 34, 27, 33, 34, 28, 25, 30, 36, 32, 23, 24 },
		{ 17, 23, 26, 21, 20, 18, 20, 23, 23, 24, 21, 20, 21, 24, 27, 23, 21, 19, 15, 18, 22, 26, 23, 22, 23, 21, 23, 28, 28, 28, 25, 21, 21, 24, 25 },
		{ -35, -42, -40, -35, -35, -34, -33, -38, -40, -37, -33, -34, -40, -43, -44, -41, -34, -31, -27, -31, -38, -38, -33, -31, -33, -30, -29, -35, -38, -35, -32, -30, -33, -37, -38 },
	},
	{
		{ -43, -109, -253, -289, 31, 514, 532, 341, 325, -404, -462, -14, -190, -224, -218, -230, 110, 615, 805, 533, -223, -717, -231, -94, -125, 317, 71, -35, -13, -13, 0, 0, 0, 0, 0 },
		{ -295, -397, -463, -98, 870, 2128, 2680, 3767, 3427, 2326, 1630, 571, 170, -394, -971, -1489, -1097, -542, 707, 2062, 4143, 5450, 5050, 3840, 2734, 559, 50, -182, -253, -112, 0, 0, 0, 0, 0 },
		{ -104, -69, -12, -30, -94, -189, -517, -497, -269, 86, -65, -58, 11, 177, 159, 238, -178, -303, -564, -850, -1268, -1052, -237, -59, 129, 262, -175, -409, -218, -54, 0, 0, 0, 0, 0 },
	},
	{
		{ 48, 13, 0, 80, 167, 0, -247, -131, 9, -102, -217, 41, 187, 378, 134, 146, -186, 37, 64, 111, 233, 295, -318, 8, 77, 17, 86, -166, -229, -69, 24, 35, -23, 25, 80 },
		{ 59, 83, 78, 40, 19, -38, -108, -280, -297, -185, -39, -30, -76, 161, 179, -37, 235, 190, 73, 242, 168, -125, 201, 34, -495, -402, -331, -97, 33, 29, -19, 6, 29, -6, -39 },
		{ -90, -112, -219, -332, -86, 929, 1530, 1615, 1365, 691, -142, -836, -895, -397, 134, -272, -689, -759, -614, -648, -406, -23, 1033, 744, 361, 120, 279, 232, 472, 346, 314, 305, 279, 110, -85 },
	},
	{
		{ 31, 48, 40, 33, 97, 73, 14, -65, -90, -28, 68, 42, 43, 92, 17, -14, -114, -165, -131, 436, -60, -222, -292, -43, -114, 93, 306, 295, 388, 268, 82, 91, 106, 67, 46 },
		{ 2, -11, 12, 25, 66, 69, 188, 347, 395, 363, 207, 221, 104, -93, -72, -149, 12, -35, -137, -486, -463, -245, -118, -60, 260, 254, 49, 49, 59, 132, 175, 233, 131, 101, 16 },
		{ -155, -170, -187, -108, 47, -41, 267, 707, 875, 1155, 1803, 1482, 1080, 657, 240, 315, -204, -742, -1550, -1711, -1622, -1582, -945, -21, 744, 499, 387, 4, 251, 418, 256, 348, 266, 288, 180 },
	},
	{
		{ -641, -627, -238, -133, -183, -451, -45, 191, 364, 160, 169, 663, -142, -458, -307, -55, 312, 385, -219, -502, -655, -296, 77, 389, 678, 710, -448, -113, 85, -31, 95, -161, 100, -180, -178 },
		{ -199, -235, -320, -817, -1199, -1191, -1640, -924, 181, 1444, 1187, 112, 784, 713, 865, 959, 741, -92, -1235, -1766, -1487, -583, 554, 976, -54, 679, 918, 353, 504, 508, 11, -1056, -1318, -989, -309 },
		{ -28, 38, 59, 249, 160, -142, -160, -330, -471, -563, -99, 158, 154, 27, -133, 58, 143, 191, 187, 67, -302, -398, -375, -104, 199, 113, -52, 100, -3, 297, 162, 169, -141, -400, -261 },
	},
	{
		{ 187, 187, 130, -130, -1003, -2179, -4103, -5071, -7092, -8706, -8615, -7655, -5532, -2798, -517, -203, -248, -582, -569, -179, 308, 257, 367, 205, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 },
		{ -30, -40, -72, -98, -97, 25, 422, 756, 1486, 2307, 2430, 2061, 1115, -79, -691, -639, -271, 116, 278, 72, -66, -89, -145, -116, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 },
		{ 16, 26, 33, 60, 101, 148, 140, -8, -286, -479, -437, -290, -186, -72, -125, -139, -225, -168, -149, -109, -76, -35, -9, 32, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127 },
	},
	{
		{ -315, -374, -377, -406, -313, 53, 1373, 2598, 4720, 7075, 8913, 9023, 8595, 7443, 4839, 2351, -44, -538, -633, -363, 500, 561, 126, -251, -335, -337, -234, -1, -1, -1, -1, -1, -1, -1, -1 },
		{ 192, 230, 204, 189, 132, 5, -489, -967, -1657, -2514, -3100, -3001, -2815, -2407, -1698, -1020, -368, -92, 108, 161, -6, 7, 88, 182, 141, 156, 188, 1, 1, 1, 1, 1, 1, 1, 1 },
		{ -50, -32, -23, -23, 13, 114, 226, 195, 148, 164, -31, -76, 63, 53, -19, -243, -450, -426, -362, -262, -105, 29, 51, 48, -19, 42, 117, 127, 127, 127, 127, 127, 127, 127, 127 },
	},
	{
		{ 128, 139, 210, 203, 107, 50, -90, -301, -150, -161, -418, -464, -218, 183, 324, 636, 659, 350, 296, 102, 160, 126, 66, 144, 125, 96, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ -23, -33, 14, 215, 714, 1543, 3152, 4288, 6172, 7962, 8572, 8184, 7615, 6061, 4967, 3298, 2439, 1984, 1225, 983, 778, 628, 502, 231, 24, 50, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		{ -109, -115, -116, -42, 63, 284, 628, 859, 1308, 1492, 1376, 1163, 975, 703, 696, 703, 521, 313, 182, -62, -180, -327, -286, -155, -176, -133, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	},
	{
		{ -5, 10, -12, -32, -79, -47, -70, -191, -538, -900, -1197, -1063, -395, 552, 630, 196, 148, -107, 95, 114, 24, 44, -2, -70, -64, 212, 189, 189, 53, 0, 0, 0, 0, 0, 0 },
		{ -46, -68, -1, 56, 36, 59, -21, -439, -2327, -4643, -6285, -8379, -10033, -8079, -5716, -4632, -4284, -3156, -2076, -1300, -773, -542, -264, 53, 144, -108, -106, -106, 28, 0, 0, 0, 0, 0, 0 },
		{ -10, -4, -15, -24, -51, -93, -128, -229, -383, -681, -979, -1124, -1459, -1633, -1526, -1289, -1095, -615, -444, -254, 8, 123, 274, 362, 297, 64, 61, 61, 76, 0, 0, 0, 0, 0, 0 },
	}
};
